<UserControl x:Class="Lazarus.Desktop.Views.HypernetworksView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:local="clr-namespace:Lazarus.Desktop.Views"
			 mc:Ignorable="d"
			 Background="{DynamicResource PrimaryDarkBrush}">

	<UserControl.Resources>
		<!-- Hypernetwork Card Template -->
		<DataTemplate x:Key="HypernetworkCardTemplate">
			<Border MinWidth="280"
					MaxWidth="320"
					Margin="0,0,12,12">
				<Border.Style>
					<Style TargetType="Border"
						   BasedOn="{StaticResource DarkCardStyle}">
						<Style.Triggers>
							<DataTrigger Binding="{Binding IsActive}"
										 Value="True">
								<Setter Property="BorderBrush"
										Value="{DynamicResource AccentRedBrush}"/>
								<Setter Property="BorderThickness"
										Value="2"/>
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</Border.Style>

				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<!-- Header with Category Badge -->
					<Grid Grid.Row="0"
						  Margin="0,0,0,8">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<TextBlock Grid.Column="0"
								   Text="ðŸ§ "
								   FontSize="24"
								   Foreground="{DynamicResource AccentRedBrush}"
								   VerticalAlignment="Center"/>

						<Border Grid.Column="1"
								Background="{DynamicResource AccentRedBrush}"
								CornerRadius="8"
								Padding="6,2">
							<TextBlock Text="{Binding Category}"
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="9"
									   FontWeight="Bold"/>
						</Border>
					</Grid>

					<!-- Name and Architecture -->
					<StackPanel Grid.Row="1"
								Margin="0,0,0,8">
						<TextBlock Text="{Binding Name}"
								   Style="{StaticResource BodyTextStyle}"
								   FontWeight="SemiBold"
								   FontSize="13"
								   TextTrimming="CharacterEllipsis"/>
						<TextBlock Text="{Binding Architecture}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"
								   Margin="0,2,0,0"
								   Foreground="{DynamicResource AccentRedBrush}"/>
					</StackPanel>

					<!-- Description -->
					<TextBlock Grid.Row="2"
							   Text="{Binding Description}"
							   Style="{StaticResource CaptionTextStyle}"
							   FontSize="11"
							   TextWrapping="Wrap"
							   MaxHeight="60"
							   Margin="0,0,0,8"/>

					<!-- Specs Grid -->
					<Grid Grid.Row="3"
						  Margin="0,0,0,8">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>

						<TextBlock Grid.Row="0"
								   Grid.Column="0"
								   Text="{Binding FileSize}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"/>
						<TextBlock Grid.Row="0"
								   Grid.Column="1"
								   Text="{Binding LayerDisplay}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"
								   HorizontalAlignment="Right"/>

						<TextBlock Grid.Row="1"
								   Grid.Column="0"
								   Text="{Binding Quality}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"/>
						<TextBlock Grid.Row="1"
								   Grid.Column="1"
								   Text="{Binding BaseModel}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"
								   HorizontalAlignment="Right"/>

						<TextBlock Grid.Row="2"
								   Grid.Column="0"
								   Text="{Binding ActivationFunction}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"/>
						<TextBlock Grid.Row="2"
								   Grid.Column="1"
								   Text="{Binding CreatedDateFormatted}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"
								   HorizontalAlignment="Right"/>

						<TextBlock Grid.Row="3"
								   Grid.ColumnSpan="2"
								   Text="{Binding Author}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"
								   HorizontalAlignment="Center"
								   Margin="0,2,0,0"/>
					</Grid>

					<!-- Action Buttons -->
					<Grid Grid.Row="4"
						  Margin="0,0,0,4">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<Button Grid.Column="0"
								Command="{Binding DataContext.ActivateHypernetworkCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
								CommandParameter="{Binding}"
								Content="Activate"
								Style="{StaticResource PrimaryButtonStyle}"
								Padding="8,8"
								FontSize="11"
								Margin="0,0,4,0"/>

						<Button Grid.Column="1"
								Content="Test"
								Command="{Binding DataContext.TestHypernetworkCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
								CommandParameter="{Binding}"
								Style="{StaticResource SecondaryButtonStyle}"
								Padding="8,6"
								FontSize="10"/>
					</Grid>

					<!-- Hash -->
					<TextBlock Grid.Row="5"
							   Text="{Binding Hash, StringFormat={}Hash: {0}}"
							   Style="{StaticResource CaptionTextStyle}"
							   FontSize="8"
							   HorizontalAlignment="Center"
							   Opacity="0.7"/>
				</Grid>
			</Border>
		</DataTemplate>

		<!-- Active Hypernetwork Template -->
		<DataTemplate x:Key="ActiveHypernetworkTemplate">
			<Border Background="{DynamicResource TertiaryDarkBrush}"
					CornerRadius="6"
					Padding="12"
					Margin="0,0,0,8">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<StackPanel Grid.Column="0"
								Grid.Row="0">
						<TextBlock Text="{Binding Name}"
								   Style="{StaticResource BodyTextStyle}"
								   FontWeight="SemiBold"
								   FontSize="12"/>
						<TextBlock Text="{Binding Architecture}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"
								   Foreground="{DynamicResource AccentRedBrush}"/>
					</StackPanel>

					<StackPanel Grid.Column="1"
								Grid.Row="0"
								Orientation="Horizontal"
								VerticalAlignment="Center"
								Margin="8,0">
						<TextBlock Text="Strength:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"
								   Margin="0,0,4,0"/>
						<TextBlock Text="{Binding StrengthDisplay}"
								   Style="{StaticResource BodyTextStyle}"
								   FontSize="10"
								   FontWeight="SemiBold"/>
					</StackPanel>

					<Button Grid.Column="2"
							Grid.Row="0"
							Content="âœ•"
							Command="{Binding DataContext.DeactivateHypernetworkCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
							CommandParameter="{Binding}"
							Style="{StaticResource DangerButtonStyle}"
							Padding="6,4"
							FontSize="10"
							ToolTip="Remove hypernetwork"/>

					<StackPanel Grid.Column="0"
								Grid.ColumnSpan="2"
								Grid.Row="1"
								Orientation="Horizontal"
								Margin="0,4,0,0">
						<TextBlock Text="{Binding LayerDisplay}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"
								   Margin="0,0,12,0"/>
						<TextBlock Text="{Binding ActivationFunction}"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="9"/>
					</StackPanel>
				</Grid>
			</Border>
		</DataTemplate>
	</UserControl.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="2*"/>
			<ColumnDefinition Width="1*"/>
		</Grid.ColumnDefinitions>

		<!-- Left: Available Hypernetworks -->
		<Border Grid.Column="0"
				Style="{StaticResource DarkBorderStyle}"
				Margin="0,0,8,0">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Header -->
				<Grid Grid.Row="0"
					  Margin="0,0,0,16">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBlock Text="Neural Hypernetworks"
							   Style="{StaticResource HeadingMediumStyle}"/>

					<Button Content="ðŸ”„"
							Command="{Binding RefreshCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Padding="8,4"
							ToolTip="Refresh Hypernetworks"/>
				</Grid>

				<!-- Filters -->
				<Grid Grid.Row="1"
					  Margin="0,0,0,16">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBox Text="{Binding SearchFilter, UpdateSourceTrigger=PropertyChanged}"
							 Style="{StaticResource DarkTextBoxStyle}"
							 Margin="0,0,8,0"/>

					<ComboBox Grid.Column="1"
							  ItemsSource="{Binding Categories}"
							  SelectedItem="{Binding SelectedCategory}"
							  Style="{StaticResource DarkComboBoxStyle}"
							  MinWidth="120"/>
				</Grid>

				<!-- Hypernetworks Grid -->
				<ScrollViewer Grid.Row="2"
							  VerticalScrollBarVisibility="Auto">
					<ItemsControl ItemsSource="{Binding AvailableHypernetworks}"
								  ItemTemplate="{DynamicResource HypernetworkCardTemplate}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<WrapPanel Orientation="Horizontal"/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
					</ItemsControl>
				</ScrollViewer>

				<!-- Status -->
				<Grid Grid.Row="3"
					  Margin="0,16,0,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBlock Grid.Column="0"
							   Text="{Binding StatusText}"
							   Foreground="{DynamicResource SuccessBrush}"
							   FontSize="12"
							   VerticalAlignment="Center"/>

					<!-- Loading indicator -->
					<StackPanel Grid.Column="1"
								Orientation="Horizontal"
								Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
						<TextBlock Text="Processing..."
								   Style="{StaticResource CaptionTextStyle}"
								   Margin="0,0,8,0"/>
						<Border Background="{DynamicResource AccentRedBrush}"
								Width="12"
								Height="12"
								CornerRadius="6">
							<Border.RenderTransform>
								<RotateTransform/>
							</Border.RenderTransform>
							<Border.Triggers>
								<EventTrigger RoutedEvent="Border.Loaded">
									<BeginStoryboard>
										<Storyboard RepeatBehavior="Forever">
											<DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
															 From="0"
															 To="360"
															 Duration="0:0:1"/>
										</Storyboard>
									</BeginStoryboard>
								</EventTrigger>
							</Border.Triggers>
						</Border>
					</StackPanel>
				</Grid>
			</Grid>
		</Border>

		<!-- Right: Active Hypernetworks -->
		<Border Grid.Column="1"
				Style="{StaticResource DarkBorderStyle}"
				Margin="8,0,0,0">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Header -->
				<Grid Grid.Row="0"
					  Margin="0,0,0,16">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBlock Text="Active Networks"
							   Style="{StaticResource HeadingMediumStyle}"/>

					<Button Content="Clear All"
							Command="{Binding ClearAllCommand}"
							Style="{StaticResource DangerButtonStyle}"
							Padding="8,4"
							FontSize="11"
							Visibility="{Binding HasActiveHypernetworks, Converter={StaticResource BooleanToVisibilityConverter}}"/>
				</Grid>

				<!-- Active Hypernetworks List -->
				<ScrollViewer Grid.Row="1"
							  VerticalScrollBarVisibility="Auto">
					<StackPanel>
						<!-- Active Hypernetworks -->
						<ItemsControl ItemsSource="{Binding ActiveHypernetworks}"
									  ItemTemplate="{DynamicResource ActiveHypernetworkTemplate}"
									  Visibility="{Binding HasActiveHypernetworks, Converter={StaticResource BooleanToVisibilityConverter}}"/>

						<!-- Empty State -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="6"
								Padding="20"
								Visibility="{Binding HasActiveHypernetworks, Converter={StaticResource InvertBool}}">
							<StackPanel HorizontalAlignment="Center">
								<TextBlock Text="ðŸ§ "
										   FontSize="32"
										   HorizontalAlignment="Center"
										   Foreground="{DynamicResource TextDisabledBrush}"
										   Margin="0,0,0,8"/>
								<TextBlock Text="No Active Networks"
										   HorizontalAlignment="Center"
										   Style="{StaticResource BodyTextStyle}"
										   FontSize="13"
										   FontWeight="Medium"/>
								<TextBlock Text="Activate hypernetworks to modify neural patterns"
										   HorizontalAlignment="Center"
										   Style="{StaticResource CaptionTextStyle}"
										   FontSize="11"
										   TextWrapping="Wrap"
										   TextAlignment="Center"
										   Margin="0,4,0,0"/>
							</StackPanel>
						</Border>
					</StackPanel>
				</ScrollViewer>

				<!-- Stats -->
				<Border Grid.Row="2"
						Background="{DynamicResource TertiaryDarkBrush}"
						CornerRadius="6"
						Padding="12,8"
						Margin="0,16,0,0">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>

						<StackPanel Grid.Column="0">
							<TextBlock Text="Available"
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="10"/>
							<TextBlock Text="{Binding TotalHypernetworksCount}"
									   Style="{StaticResource HeadingMediumStyle}"
									   FontSize="16"/>
						</StackPanel>

						<StackPanel Grid.Column="1">
							<TextBlock Text="Active"
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="10"/>
							<TextBlock Text="{Binding ActiveHypernetworksCount}"
									   Style="{StaticResource HeadingMediumStyle}"
									   FontSize="16"
									   Foreground="{DynamicResource AccentRedBrush}"/>
						</StackPanel>
					</Grid>
				</Border>
			</Grid>
		</Border>
	</Grid>
</UserControl>