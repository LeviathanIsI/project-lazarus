<UserControl x:Class="Lazarus.Desktop.Views.AdvancedView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:local="clr-namespace:Lazarus.Desktop.Views"
			 mc:Ignorable="d"
			 Background="{StaticResource PrimaryDarkBrush}">

	<UserControl.Resources>
		<!-- Setting Item Template -->
		<DataTemplate x:Key="SettingTemplate">
			<Border Background="{StaticResource TertiaryDarkBrush}"
					CornerRadius="6"
					Padding="16"
					Margin="0,0,0,8">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<!-- Setting Name and Warning Badge -->
					<StackPanel Grid.Column="0"
								Grid.Row="0"
								Orientation="Horizontal">
						<TextBlock Text="{Binding Name}"
								   Style="{StaticResource BodyTextStyle}"
								   FontWeight="SemiBold"
								   FontSize="13"/>

						<!-- Warning Level Badge -->
						<Border Margin="8,0,0,0"
								Padding="4,2"
								CornerRadius="4">
							<Border.Style>
								<Style TargetType="Border">
									<Style.Triggers>
										<DataTrigger Binding="{Binding WarningLevel}"
													 Value="Safe">
											<Setter Property="Background"
													Value="{StaticResource SuccessBrush}"/>
										</DataTrigger>
										<DataTrigger Binding="{Binding WarningLevel}"
													 Value="Caution">
											<Setter Property="Background"
													Value="{StaticResource WarningBrush}"/>
										</DataTrigger>
										<DataTrigger Binding="{Binding WarningLevel}"
													 Value="Experimental">
											<Setter Property="Background"
													Value="{StaticResource AccentPurpleBrush}"/>
										</DataTrigger>
										<DataTrigger Binding="{Binding WarningLevel}"
													 Value="Dangerous">
											<Setter Property="Background"
													Value="{StaticResource ErrorBrush}"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</Border.Style>
							<TextBlock Text="{Binding WarningLevel}"
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="8"
									   FontWeight="Bold"/>
						</Border>

						<!-- Restart Required Badge -->
						<Border Background="{StaticResource ErrorBrush}"
								CornerRadius="4"
								Padding="4,2"
								Margin="4,0,0,0"
								Visibility="{Binding RequiresRestart, Converter={StaticResource BooleanToVisibilityConverter}}">
							<TextBlock Text="RESTART"
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="8"
									   FontWeight="Bold"/>
						</Border>
					</StackPanel>

					<!-- Value Control -->
					<StackPanel Grid.Column="1"
								Grid.Row="0"
								Orientation="Horizontal"
								VerticalAlignment="Center">
						<!-- Boolean Toggle -->
						<CheckBox IsChecked="{Binding Value}"
								  Style="{StaticResource DarkCheckBoxStyle}"
								  Visibility="{Binding ValueType, Converter={StaticResource StringEqualsVisibilityConverter}, ConverterParameter=bool}"/>

						<!-- Numeric Input -->
						<TextBox Text="{Binding Value}"
								 Style="{StaticResource DarkTextBoxStyle}"
								 MinWidth="80"
								 Visibility="{Binding ValueType, Converter={StaticResource StringEqualsVisibilityConverter}, ConverterParameter=int}"/>

						<!-- String Input -->
						<TextBox Text="{Binding Value}"
								 Style="{StaticResource DarkTextBoxStyle}"
								 MinWidth="150"
								 Visibility="{Binding ValueType, Converter={StaticResource StringEqualsVisibilityConverter}, ConverterParameter=string}"/>
					</StackPanel>

					<!-- Enable/Disable Toggle -->
					<CheckBox Grid.Column="2"
							  Grid.Row="0"
							  IsChecked="{Binding IsEnabled}"
							  Style="{StaticResource DarkCheckBoxStyle}"
							  Content="Enabled"
							  Margin="16,0,0,0"/>

					<!-- Description -->
					<TextBlock Grid.Column="0"
							   Grid.ColumnSpan="3"
							   Grid.Row="1"
							   Text="{Binding Description}"
							   Style="{StaticResource CaptionTextStyle}"
							   FontSize="11"
							   TextWrapping="Wrap"
							   Margin="0,6,0,0"/>
				</Grid>
			</Border>
		</DataTemplate>
	</UserControl.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="2*"/>
			<ColumnDefinition Width="1*"/>
		</Grid.ColumnDefinitions>

		<!-- Left: Settings -->
		<Border Grid.Column="0"
				Style="{StaticResource DarkBorderStyle}"
				Margin="0,0,8,0">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Header -->
				<Grid Grid.Row="0"
					  Margin="0,0,0,16">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBlock Text="Advanced Configuration"
							   Style="{StaticResource HeadingMediumStyle}"/>

					<CheckBox Grid.Column="1"
							  Content="Developer Mode"
							  IsChecked="{Binding DeveloperMode}"
							  Style="{StaticResource DarkCheckBoxStyle}"
							  Margin="16,0"/>

					<Button Grid.Column="2"
							Content="🔄"
							Command="{Binding RefreshCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Padding="8,4"
							ToolTip="Refresh Settings"/>
				</Grid>

				<!-- Filters -->
				<Grid Grid.Row="1"
					  Margin="0,0,0,16">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBox Text="{Binding SearchFilter, UpdateSourceTrigger=PropertyChanged}"
							 Style="{StaticResource DarkTextBoxStyle}"
							 Margin="0,0,8,0"/>

					<ComboBox Grid.Column="1"
							  ItemsSource="{Binding Categories}"
							  SelectedItem="{Binding SelectedCategory}"
							  Style="{StaticResource DarkComboBoxStyle}"
							  MinWidth="120"/>
				</Grid>

				<!-- Settings List -->
				<ScrollViewer Grid.Row="2"
							  VerticalScrollBarVisibility="Auto">
					<ItemsControl ItemsSource="{Binding FilteredSettings}"
								  ItemTemplate="{StaticResource SettingTemplate}"/>
				</ScrollViewer>

				<!-- Action Buttons -->
				<Grid Grid.Row="3"
					  Margin="0,16,0,0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="Auto"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<TextBlock Grid.Column="0"
							   Text="{Binding StatusText}"
							   Foreground="{StaticResource SuccessBrush}"
							   FontSize="12"
							   VerticalAlignment="Center"/>

					<Button Grid.Column="1"
							Content="Apply Changes"
							Command="{Binding ApplyChangesCommand}"
							Style="{StaticResource PrimaryButtonStyle}"
							Padding="12,6"
							FontSize="11"
							Margin="8,0,0,0"/>

					<Button Grid.Column="2"
							Content="Export Config"
							Command="{Binding ExportConfigCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Padding="8,6"
							FontSize="10"
							Margin="4,0,0,0"/>

					<Button Grid.Column="3"
							Content="Import Config"
							Command="{Binding ImportConfigCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Padding="8,6"
							FontSize="10"
							Margin="4,0,0,0"/>

					<Button Grid.Column="4"
							Content="Reset Defaults"
							Command="{Binding ResetToDefaultsCommand}"
							Style="{StaticResource DangerButtonStyle}"
							Padding="8,6"
							FontSize="10"
							Margin="4,0,0,0"/>
				</Grid>
			</Grid>
		</Border>

		<!-- Right: System Info & Dangerous Actions -->
		<Border Grid.Column="1"
				Style="{StaticResource DarkBorderStyle}"
				Margin="8,0,0,0">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Header -->
				<TextBlock Grid.Row="0"
						   Text="System Status"
						   Style="{StaticResource HeadingMediumStyle}"
						   Margin="0,0,0,16"/>

				<!-- System Info -->
				<Border Grid.Row="1"
						Background="{StaticResource TertiaryDarkBrush}"
						CornerRadius="6"
						Padding="16"
						Margin="0,0,0,16">
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<TextBlock Grid.Row="0"
								   Grid.Column="0"
								   Text="GPU:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"/>
						<TextBlock Grid.Row="0"
								   Grid.Column="1"
								   Text="{Binding SystemInfo.GpuName}"
								   Style="{StaticResource BodyTextStyle}"
								   FontSize="10"/>

						<TextBlock Grid.Row="1"
								   Grid.Column="0"
								   Text="VRAM:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"/>
						<StackPanel Grid.Row="1"
									Grid.Column="1"
									Orientation="Horizontal">
							<TextBlock Text="{Binding SystemInfo.VramUsed}"
									   Style="{StaticResource BodyTextStyle}"
									   FontSize="10"/>
							<TextBlock Text=" / "
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="10"/>
							<TextBlock Text="{Binding SystemInfo.VramTotal}"
									   Style="{StaticResource BodyTextStyle}"
									   FontSize="10"/>
						</StackPanel>

						<TextBlock Grid.Row="2"
								   Grid.Column="0"
								   Text="RAM:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"/>
						<StackPanel Grid.Row="2"
									Grid.Column="1"
									Orientation="Horizontal">
							<TextBlock Text="{Binding SystemInfo.RamUsed}"
									   Style="{StaticResource BodyTextStyle}"
									   FontSize="10"/>
							<TextBlock Text=" / "
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="10"/>
							<TextBlock Text="{Binding SystemInfo.RamTotal}"
									   Style="{StaticResource BodyTextStyle}"
									   FontSize="10"/>
						</StackPanel>

						<TextBlock Grid.Row="3"
								   Grid.Column="0"
								   Text="CPU:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"/>
						<TextBlock Grid.Row="3"
								   Grid.Column="1"
								   Text="{Binding SystemInfo.CpuName}"
								   Style="{StaticResource BodyTextStyle}"
								   FontSize="10"/>

						<TextBlock Grid.Row="4"
								   Grid.Column="0"
								   Text="CPU Usage:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"/>
						<TextBlock Grid.Row="4"
								   Grid.Column="1"
								   Text="{Binding SystemInfo.CpuUsage, StringFormat={}{0:F1}%}"
								   Style="{StaticResource BodyTextStyle}"
								   FontSize="10"/>

						<TextBlock Grid.Row="5"
								   Grid.Column="0"
								   Text="GPU Usage:"
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"/>
						<TextBlock Grid.Row="5"
								   Grid.Column="1"
								   Text="{Binding SystemInfo.GpuUsage, StringFormat={}{0:F1}%}"
								   Style="{StaticResource BodyTextStyle}"
								   FontSize="10"/>
					</Grid>
				</Border>

				<!-- Warning Section -->
				<Border Grid.Row="2"
						Background="{StaticResource ErrorBrush}"
						CornerRadius="6"
						Padding="16"
						Margin="0,0,0,16"
						Opacity="0.9">
					<StackPanel>
						<TextBlock Text="⚠️ DANGER ZONE"
								   Style="{StaticResource HeadingSmallStyle}"
								   FontSize="12"
								   HorizontalAlignment="Center"
								   Margin="0,0,0,8"/>

						<TextBlock Text="Advanced settings can break your installation, corrupt models, or cause system instability. Modify with extreme caution."
								   Style="{StaticResource CaptionTextStyle}"
								   FontSize="10"
								   TextWrapping="Wrap"
								   TextAlignment="Center"
								   Margin="0,0,0,12"/>

						<CheckBox Content="Enable Debug Logging"
								  IsChecked="{Binding DebugLogging}"
								  Style="{StaticResource DarkCheckBoxStyle}"
								  FontSize="10"
								  Margin="0,0,0,8"/>

						<Button Content="🚨 Force Restart Application"
								Command="{Binding RestartApplicationCommand}"
								Style="{StaticResource DangerButtonStyle}"
								Padding="12,8"
								FontSize="11"
								HorizontalAlignment="Stretch"/>
					</StackPanel>
				</Border>

				<!-- Loading Indicator -->
				<StackPanel Grid.Row="3"
							Orientation="Horizontal"
							HorizontalAlignment="Center"
							Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
					<TextBlock Text="Processing..."
							   Style="{StaticResource CaptionTextStyle}"
							   Margin="0,0,8,0"/>
					<Border Background="{StaticResource AccentPurpleBrush}"
							Width="12"
							Height="12"
							CornerRadius="6">
						<Border.RenderTransform>
							<RotateTransform/>
						</Border.RenderTransform>
						<Border.Triggers>
							<EventTrigger RoutedEvent="Border.Loaded">
								<BeginStoryboard>
									<Storyboard RepeatBehavior="Forever">
										<DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
														 From="0"
														 To="360"
														 Duration="0:0:1"/>
									</Storyboard>
								</BeginStoryboard>
							</EventTrigger>
						</Border.Triggers>
					</Border>
				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</UserControl>