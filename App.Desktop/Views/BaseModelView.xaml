<UserControl x:Class="Lazarus.Desktop.Views.BaseModelView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:local="clr-namespace:Lazarus.Desktop.Views"
			 mc:Ignorable="d"
			 Background="{DynamicResource PrimaryDarkBrush}">

	<!-- BASE MODEL MANAGEMENT: The Neural Core Command Center -->
	<!-- Professional three-column layout for model selection, configuration, and monitoring -->
	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="320" MinWidth="280"/>  <!-- Model Selection & Loading -->
			<ColumnDefinition Width="*"/>                   <!-- Configuration & Testing -->
			<ColumnDefinition Width="300" MinWidth="250"/>  <!-- Model Info & Status -->
		</Grid.ColumnDefinitions>

		<!-- LEFT COLUMN: Model Selection & Loading Interface -->
		<Border Grid.Column="0" Background="{DynamicResource SecondaryDarkBrush}" 
				Padding="16" Margin="0,0,8,0">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel>
					<!-- Model Library Header -->
					<Grid Margin="0,0,0,16">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						
						<TextBlock Text="Model Library" 
								   Style="{DynamicResource HeadingMediumStyle}"
								   Foreground="{DynamicResource AccentRedBrush}"
								   VerticalAlignment="Center"/>
						
						<Button Grid.Column="1" Content="🔍 Scan" 
								Style="{DynamicResource SecondaryButtonStyle}"
								Command="{Binding ScanModelsCommand}"
								ToolTip="Scan for new models"/>
					</Grid>

					<!-- Model Search Filter -->
					<Border Background="{DynamicResource TertiaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="12,8" 
							Margin="0,0,0,12">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<TextBlock Text="🔎" FontSize="14" 
									   VerticalAlignment="Center" 
									   Margin="0,0,8,0"
									   Foreground="{DynamicResource TextMutedBrush}"/>
							<TextBox Grid.Column="1" 
									 Text="{Binding SearchFilter, UpdateSourceTrigger=PropertyChanged}"
									 Background="Transparent" 
									 BorderThickness="0"
									 Foreground="{DynamicResource TextPrimaryBrush}"
									 VerticalAlignment="Center">
								<TextBox.Style>
									<Style TargetType="TextBox">
										<Setter Property="Template">
											<Setter.Value>
												<ControlTemplate TargetType="TextBox">
													<Grid>
														<ScrollViewer x:Name="PART_ContentHost"
																	  Background="Transparent"
																	  BorderThickness="0"
																	  IsTabStop="False"/>
														<TextBlock Text="Filter models..." 
																   Foreground="{DynamicResource TextMutedBrush}"
																   FontStyle="Italic"
																   VerticalAlignment="Center"
																   Margin="2,0,0,0"
																   IsHitTestVisible="False">
															<TextBlock.Style>
																<Style TargetType="TextBlock">
																	<Setter Property="Visibility" Value="Collapsed"/>
																	<Style.Triggers>
																		<DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
																			<Setter Property="Visibility" Value="Visible"/>
																		</DataTrigger>
																	</Style.Triggers>
																</Style>
															</TextBlock.Style>
														</TextBlock>
													</Grid>
												</ControlTemplate>
											</Setter.Value>
										</Setter>
									</Style>
								</TextBox.Style>
							</TextBox>
						</Grid>
					</Border>

					<!-- Model Selection List -->
					<Border Background="{DynamicResource TertiaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="0" 
							MinHeight="300"
							Margin="0,0,0,16">
						<ScrollViewer VerticalScrollBarVisibility="Auto">
							<ListBox x:Name="ModelList" ItemsSource="{Binding FilteredModels}" SelectedItem="{Binding SelectedModel, Mode=TwoWay}" SelectedIndex="-1" BorderThickness="0" Background="Transparent">
								<ListBox.ItemTemplate>
									<DataTemplate>
										<Border Background="Transparent" Padding="12,8" Margin="0,0,0,1">
											<Border.Style>
												<Style TargetType="Border">
													<Style.Triggers>
														<Trigger Property="IsMouseOver" Value="True">
															<Setter Property="Background" Value="{DynamicResource AccentRedBrush}"/>
														</Trigger>
														<DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
															<Setter Property="Background" Value="{DynamicResource AccentRedBrush}"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</Border.Style>
											<Grid>
												<Grid.RowDefinitions>
													<RowDefinition Height="Auto"/>
													<RowDefinition Height="Auto"/>
													<RowDefinition Height="Auto"/>
												</Grid.RowDefinitions>
												<TextBlock Text="{Binding Name}" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}" TextTrimming="CharacterEllipsis"/>
												<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,2,0,0">
													<Border Background="{DynamicResource AccentRedBrush}" CornerRadius="8" Padding="4,1">
														<TextBlock Text="{Binding Size}" FontSize="10" Foreground="White"/>
													</Border>
													<Border Background="{DynamicResource TertiaryDarkBrush}" CornerRadius="8" Padding="4,1" Margin="4,0,0,0">
														<TextBlock Text="{Binding Quantization}" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"/>
													</Border>
												</StackPanel>
												<TextBlock Grid.Row="2" Text="{Binding Architecture}" FontSize="11" Foreground="{DynamicResource TextMutedBrush}" Margin="0,4,0,0"/>
											</Grid>
										</Border>
									</DataTemplate>
								</ListBox.ItemTemplate>
							</ListBox>
						</ScrollViewer>
					</Border>

					<!-- Load/Unload Controls -->
					<Grid Margin="0,0,0,16">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						
						<Button Content="Load Model" 
								Style="{DynamicResource PrimaryButtonStyle}"
								Command="{Binding LoadModelCommand}"
								CommandParameter="{Binding ElementName=ModelList, Path=SelectedItem}"
								IsEnabled="{Binding ElementName=ModelList, Path=SelectedItem, Converter={StaticResource NullToBooleanConverter}}"
								Margin="0,0,4,0"/>
						
						<Button Grid.Column="1" 
								Content="Unload" 
								Style="{DynamicResource SecondaryButtonStyle}"
								Command="{Binding UnloadModelCommand}"
								Margin="4,0,0,0"/>
					</Grid>

					<!-- Loading Status -->
					<Border Background="{DynamicResource TertiaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="12" 
							Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
						<StackPanel Orientation="Horizontal">
							<Border Background="{DynamicResource AccentRedBrush}" 
									Width="16" Height="16" 
									CornerRadius="8" 
									Margin="0,0,8,0">
								<Border.RenderTransform>
									<RotateTransform x:Name="LoadingSpinner"/>
								</Border.RenderTransform>
								<Border.Triggers>
									<EventTrigger RoutedEvent="Border.Loaded">
										<BeginStoryboard>
											<Storyboard RepeatBehavior="Forever">
												<DoubleAnimation Storyboard.TargetName="LoadingSpinner"
																 Storyboard.TargetProperty="Angle"
																 From="0" To="360" 
																 Duration="0:0:1"/>
											</Storyboard>
										</BeginStoryboard>
									</EventTrigger>
								</Border.Triggers>
							</Border>
							<TextBlock Text="{Binding LoadingStatus}" 
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   VerticalAlignment="Center"/>
						</StackPanel>
					</Border>
				</StackPanel>
			</ScrollViewer>
		</Border>

		<!-- CENTER COLUMN: Configuration & Testing Interface -->
		<Border Grid.Column="1" Background="{DynamicResource PrimaryDarkBrush}" 
				Padding="16" Margin="0,0,8,0">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel>
					<!-- Model Configuration Header -->
					<Grid Margin="0,0,0,16">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						
						<TextBlock Text="Model Configuration" 
								   Style="{DynamicResource HeadingMediumStyle}"
								   Foreground="{DynamicResource AccentRedBrush}"/>
						
						<StackPanel Grid.Column="1" Orientation="Horizontal">
							<Border Background="{DynamicResource SuccessBrush}" 
									CornerRadius="8" 
									Padding="8,4"
									Visibility="{Binding IsModelLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
								<TextBlock Text="Model Loaded" 
										   Foreground="White" 
										   FontSize="11" 
										   FontWeight="SemiBold"/>
							</Border>
						</StackPanel>
					</Grid>

					<!-- System Prompt Configuration -->
					<Border Background="{DynamicResource SecondaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="16" 
							Margin="0,0,0,16">
						<StackPanel>
							<TextBlock Text="System Prompt" 
									   Style="{DynamicResource HeadingSmallStyle}"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   Margin="0,0,0,8"/>
							
							<TextBox Text="{Binding SystemPrompt, UpdateSourceTrigger=PropertyChanged}"
									 Background="{DynamicResource TertiaryDarkBrush}"
									 BorderBrush="{DynamicResource BorderBrush}"
									 BorderThickness="1"
									 Foreground="{DynamicResource TextPrimaryBrush}"
									 Padding="12"
									 MinHeight="120"
									 AcceptsReturn="True"
									 TextWrapping="Wrap"
									 ScrollViewer.VerticalScrollBarVisibility="Auto"/>
						</StackPanel>
					</Border>

					<!-- Sampling Parameters -->
					<Border Background="{DynamicResource SecondaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="16" 
							Margin="0,0,0,16"
							Visibility="{Binding IsModelLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
						<StackPanel>
							<TextBlock Text="Sampling Parameters" 
									   Style="{DynamicResource HeadingSmallStyle}"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   Margin="0,0,0,12"/>
							
							<!-- Temperature -->
							<Grid Margin="0,0,0,12">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="120"/>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="60"/>
								</Grid.ColumnDefinitions>
								
								<TextBlock Text="Temperature" 
										   Style="{DynamicResource BodyTextStyle}"
										   VerticalAlignment="Center"/>
								
								<Slider Grid.Column="1" 
										Value="{Binding Temperature}"
										Minimum="0.0" Maximum="2.0" 
										TickFrequency="0.1"
										IsSnapToTickEnabled="True"
										Margin="8,0"/>
								
								<TextBox Grid.Column="2" 
										 Text="{Binding Temperature, StringFormat=F1}"
										 Background="{DynamicResource TertiaryDarkBrush}"
										 BorderBrush="{DynamicResource BorderBrush}"
										 BorderThickness="1"
										 Foreground="{DynamicResource TextPrimaryBrush}"
										 Padding="4"
										 HorizontalContentAlignment="Center"/>
							</Grid>

							<!-- Top P -->
							<Grid Margin="0,0,0,12">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="120"/>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="60"/>
								</Grid.ColumnDefinitions>
								
								<TextBlock Text="Top P" 
										   Style="{DynamicResource BodyTextStyle}"
										   VerticalAlignment="Center"/>
								
								<Slider Grid.Column="1" 
										Value="{Binding TopP}"
										Minimum="0.0" Maximum="1.0" 
										TickFrequency="0.05"
										IsSnapToTickEnabled="True"
										Margin="8,0"/>
								
								<TextBox Grid.Column="2" 
										 Text="{Binding TopP, StringFormat=F2}"
										 Background="{DynamicResource TertiaryDarkBrush}"
										 BorderBrush="{DynamicResource BorderBrush}"
										 BorderThickness="1"
										 Foreground="{DynamicResource TextPrimaryBrush}"
										 Padding="4"
										 HorizontalContentAlignment="Center"/>
							</Grid>

							<!-- Max Tokens -->
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="120"/>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="60"/>
								</Grid.ColumnDefinitions>
								
								<TextBlock Text="Max Tokens" 
										   Style="{DynamicResource BodyTextStyle}"
										   VerticalAlignment="Center"/>
								
								<Slider Grid.Column="1" 
										Value="{Binding MaxTokens}"
										Minimum="1" Maximum="4096" 
										TickFrequency="64"
										IsSnapToTickEnabled="True"
										Margin="8,0"/>
								
								<TextBox Grid.Column="2" 
										 Text="{Binding MaxTokens}"
										 Background="{DynamicResource TertiaryDarkBrush}"
										 BorderBrush="{DynamicResource BorderBrush}"
										 BorderThickness="1"
										 Foreground="{DynamicResource TextPrimaryBrush}"
										 Padding="4"
										 HorizontalContentAlignment="Center"/>
							</Grid>
						</StackPanel>
					</Border>

					<!-- Test Prompt Laboratory -->
					<Border Background="{DynamicResource SecondaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="16"
							Visibility="{Binding IsModelLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
						<StackPanel>
							<Grid Margin="0,0,0,12">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="Auto"/>
								</Grid.ColumnDefinitions>
								
								<TextBlock Text="Test Laboratory" 
										   Style="{DynamicResource HeadingSmallStyle}"
										   Foreground="{DynamicResource TextPrimaryBrush}"/>
								
								<Button Grid.Column="1" 
										Content="Execute Test" 
										Style="{DynamicResource PrimaryButtonStyle}"
										Command="{Binding TestModelCommand}"
										IsEnabled="{Binding CanTestModel}"/>
							</Grid>
							
							<TextBox Text="{Binding TestPrompt, UpdateSourceTrigger=PropertyChanged}"
									 Background="{DynamicResource TertiaryDarkBrush}"
									 BorderBrush="{DynamicResource BorderBrush}"
									 BorderThickness="1"
									 Foreground="{DynamicResource TextPrimaryBrush}"
									 Padding="12"
									 MinHeight="100"
									 AcceptsReturn="True"
									 TextWrapping="Wrap"
									 ScrollViewer.VerticalScrollBarVisibility="Auto"
									 Margin="0,0,0,12"/>
							
							<!-- Response Area -->
							<Border Background="{DynamicResource TertiaryDarkBrush}" 
									BorderBrush="{DynamicResource BorderBrush}" 
									BorderThickness="1" 
									CornerRadius="4" 
									Padding="12" 
									MinHeight="150"
									MaxHeight="300">
								<ScrollViewer VerticalScrollBarVisibility="Auto">
									<TextBlock Text="{Binding TestResponse}" 
											   Foreground="{DynamicResource TextPrimaryBrush}"
											   TextWrapping="Wrap"/>
								</ScrollViewer>
							</Border>
						</StackPanel>
					</Border>
				</StackPanel>
			</ScrollViewer>
		</Border>

		<!-- RIGHT COLUMN: Model Information & Status -->
		<Border Grid.Column="2" Background="{DynamicResource SecondaryDarkBrush}" 
				Padding="16">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel>
					<!-- Model Status Header -->
					<TextBlock Text="Model Status" 
							   Style="{DynamicResource HeadingMediumStyle}"
							   Foreground="{DynamicResource AccentRedBrush}"
							   Margin="0,0,0,16"/>

					<!-- Current Model Information -->
					<Border Background="{DynamicResource TertiaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="16" 
							Margin="0,0,0,16">
						<StackPanel>
							<TextBlock Text="{Binding SelectedModel.Name}" 
									   Style="{DynamicResource HeadingSmallStyle}"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   TextWrapping="Wrap"
									   Margin="0,0,0,12"/>
							
							<Grid Margin="0,0,0,6">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="80"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<TextBlock Text="Size:" 
										   Foreground="{DynamicResource TextMutedBrush}"/>
								<TextBlock Grid.Column="1" 
										   Text="{Binding SelectedModel.Size}" 
										   Foreground="{DynamicResource TextPrimaryBrush}"
										   FontWeight="SemiBold"/>
							</Grid>
							
							<Grid Margin="0,0,0,6">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="80"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<TextBlock Text="Context:" 
										   Foreground="{DynamicResource TextMutedBrush}"/>
								<TextBlock Grid.Column="1" 
										   Text="{Binding SelectedModel.ContextLength, StringFormat={}{0:N0} tokens}" 
										   Foreground="{DynamicResource TextPrimaryBrush}"
										   FontWeight="SemiBold"/>
							</Grid>
							
							<Grid Margin="0,0,0,6">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="80"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<TextBlock Text="Arch:" 
										   Foreground="{DynamicResource TextMutedBrush}"/>
								<TextBlock Grid.Column="1" 
										   Text="{Binding SelectedModel.Architecture}" 
										   Foreground="{DynamicResource TextPrimaryBrush}"
										   FontWeight="SemiBold"/>
							</Grid>
							
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="80"/>
									<ColumnDefinition Width="*"/>
								</Grid.ColumnDefinitions>
								<TextBlock Text="Quant:" 
										   Foreground="{DynamicResource TextMutedBrush}"/>
								<TextBlock Grid.Column="1" 
										   Text="{Binding SelectedModel.Quantization}" 
										   Foreground="{DynamicResource TextPrimaryBrush}"
										   FontWeight="SemiBold"/>
							</Grid>
						</StackPanel>
					</Border>

					<!-- Performance Metrics -->
					<Border Background="{DynamicResource TertiaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="16" 
							Margin="0,0,0,16"
							Visibility="{Binding IsModelLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
						<StackPanel>
							<TextBlock Text="Performance" 
									   Style="{DynamicResource HeadingSmallStyle}"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   Margin="0,0,0,12"/>
							
							<Grid Margin="0,0,0,8">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="Auto"/>
								</Grid.ColumnDefinitions>
								<TextBlock Text="Tokens/sec:" 
										   Foreground="{DynamicResource TextMutedBrush}"/>
								<TextBlock Grid.Column="1" 
										   Text="{Binding TokensPerSecond, StringFormat=F1}" 
										   Foreground="{DynamicResource SuccessBrush}"
										   FontWeight="Bold"/>
							</Grid>
							
							<Grid Margin="0,0,0,8">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*"/>
									<ColumnDefinition Width="Auto"/>
								</Grid.ColumnDefinitions>
								<TextBlock Text="VRAM Usage:" 
										   Foreground="{DynamicResource TextMutedBrush}"/>
								<TextBlock Grid.Column="1" 
										   Text="{Binding VramUsage}" 
										   Foreground="{DynamicResource AccentRedBrush}"
										   FontWeight="Bold"/>
							</Grid>
							
							<ProgressBar Value="{Binding VramPercentage}" 
										 Maximum="100" 
										 Height="8" 
										 Background="{DynamicResource TertiaryDarkBrush}"
										 Foreground="{DynamicResource AccentRedBrush}"
										 Margin="0,4,0,0"/>
						</StackPanel>
					</Border>

					<!-- Quick Actions -->
					<Border Background="{DynamicResource TertiaryDarkBrush}" 
							BorderBrush="{DynamicResource BorderBrush}" 
							BorderThickness="1" 
							CornerRadius="4" 
							Padding="16">
						<StackPanel>
							<TextBlock Text="Quick Actions" 
									   Style="{DynamicResource HeadingSmallStyle}"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   Margin="0,0,0,12"/>
							
							<Button Content="Export Configuration" 
									Style="{DynamicResource SecondaryButtonStyle}"
									Command="{Binding ExportConfigCommand}"
									Margin="0,0,0,8"/>
							
							<Button Content="Import Configuration" 
									Style="{DynamicResource SecondaryButtonStyle}"
									Command="{Binding ImportConfigCommand}"
									Margin="0,0,0,8"/>
							
							<Button Content="Reset to Defaults" 
									Style="{DynamicResource SecondaryButtonStyle}"
									Command="{Binding ResetConfigCommand}"/>
						</StackPanel>
					</Border>
				</StackPanel>
			</ScrollViewer>
		</Border>
	</Grid>
</UserControl>