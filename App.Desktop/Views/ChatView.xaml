<UserControl x:Class="Lazarus.Desktop.Views.ChatView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d">

	<Grid Margin="12">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="300" MinWidth="250"/>
		</Grid.ColumnDefinitions>

		<!-- Main Chat Area -->
		<Grid Grid.Column="0">
			<Grid.RowDefinitions>
				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<!-- No Model Loaded State -->
			<Grid Grid.Row="0" 
				  Visibility="{Binding HasBaseModel, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
				  Background="{DynamicResource SecondaryDarkBrush}">
				<TextBlock Text="No Base Model Loaded - Please configure a model first" 
				           HorizontalAlignment="Center" 
				           VerticalAlignment="Center"
				           FontSize="16" 
				           Foreground="{DynamicResource TextSecondaryBrush}"/>
			</Grid>

			<!-- Chat Messages Area -->
			<Grid Grid.Row="0"
				  Visibility="{Binding HasBaseModel, Converter={StaticResource BooleanToVisibilityConverter}}">
				<ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16"
						  Background="{DynamicResource SecondaryDarkBrush}"
						  x:Name="ChatScrollViewer">
					<ItemsControl ItemsSource="{Binding Messages}"
								  ItemTemplate="{DynamicResource ChatMessageTemplate}"/>
				</ScrollViewer>
			</Grid>

			<!-- Original Loading Checklist (commented out but preserved for reference) -->
			<!--<Grid Grid.Row="0" 
				  Visibility="{Binding HasBaseModel, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
				  Background="{DynamicResource SecondaryDarkBrush}">
				<ScrollViewer VerticalScrollBarVisibility="Auto" Padding="32">
					<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="500">
						Header
						<Border Background="{DynamicResource TertiaryDarkBrush}" 
								CornerRadius="8" 
								Padding="24">
							<StackPanel>
								<TextBlock Text="AI Component Status"
										   Style="{StaticResource BodyTextStyle}"
										   FontSize="16"
										   FontWeight="SemiBold"
										   Margin="0,0,0,16"/>

								Base Model (Required)
								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											Background="{DynamicResource BorderBrush}"
											CornerRadius="12"
											Width="20" Height="20">
										<TextBlock Text="✗" 
												   Style="{StaticResource BodyTextStyle}"
												   FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource TextMutedBrush}"/>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="Base Model"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   Text="Required"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource AccentRedBrush}"/>
								</Grid>

								LoRAs (Optional)
								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											CornerRadius="12"
											Width="20" Height="20">
										<Border.Style>
											<Style TargetType="Border">
												<Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
												<Style.Triggers>
													<DataTrigger Binding="{Binding LorAsViewModel.AppliedLoRAsCount}" Value="0">
														<Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
													</DataTrigger>
													<DataTrigger Binding="{Binding LorAsViewModel.AppliedLoRAsCount, Converter={StaticResource ZeroToVisibilityConverter}}" Value="Visible">
														<Setter Property="Background" Value="{DynamicResource AccentRedBrush}"/>
													</DataTrigger>
												</Style.Triggers>
											</Style>
										</Border.Style>
										<TextBlock FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center">
											<TextBlock.Style>
												<Style TargetType="TextBlock" BasedOn="{StaticResource BodyTextStyle}">
													<Setter Property="Text" Value="−"/>
													<Setter Property="Foreground" Value="{DynamicResource TextMutedBrush}"/>
													<Style.Triggers>
														<DataTrigger Binding="{Binding LorAsViewModel.AppliedLoRAsCount, Converter={StaticResource ZeroToVisibilityConverter}}" Value="Visible">
															<Setter Property="Text" Value="✓"/>
															<Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</TextBlock.Style>
										</TextBlock>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="LoRAs"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource AccentRedBrush}"
											   Margin="0,0,8,0">
										<TextBlock.Style>
											<Style TargetType="TextBlock" BasedOn="{StaticResource CaptionTextStyle}">
												<Setter Property="Text" Value=""/>
												<Style.Triggers>
													<DataTrigger Binding="{Binding LorAsViewModel.AppliedLoRAsCount, Converter={StaticResource ZeroToVisibilityConverter}}" Value="Visible">
														<Setter Property="Text" Value="{Binding LorAsViewModel.AppliedLoRAsCount, StringFormat={}{0} Applied}"/>
													</DataTrigger>
												</Style.Triggers>
											</Style>
										</TextBlock.Style>
									</TextBlock>
											   
									<TextBlock Grid.Column="3"
											   Text="Optional"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource TextMutedBrush}"/>
								</Grid>

								ControlNets (Optional)
								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											Background="{DynamicResource BorderBrush}"
											CornerRadius="12"
											Width="20" Height="20">
										<TextBlock Text="−" 
												   Style="{StaticResource BodyTextStyle}"
												   FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource TextMutedBrush}"/>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="ControlNets"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   Text="Optional"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource TextMutedBrush}"/>
								</Grid>

								VAEs (Optional)
								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											Background="{DynamicResource BorderBrush}"
											CornerRadius="12"
											Width="20" Height="20">
										<TextBlock Text="−" 
												   Style="{StaticResource BodyTextStyle}"
												   FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource TextMutedBrush}"/>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="VAEs"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   Text="Optional"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource TextMutedBrush}"/>
								</Grid>

								Embeddings (Optional)
								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											Background="{DynamicResource BorderBrush}"
											CornerRadius="12"
											Width="20" Height="20">
										<TextBlock Text="−" 
												   Style="{StaticResource BodyTextStyle}"
												   FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource TextMutedBrush}"/>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="Embeddings"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   Text="Optional"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource TextMutedBrush}"/>
								</Grid>

								Hypernetworks (Optional)
								<Grid Margin="0,0,0,12">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											Background="{DynamicResource BorderBrush}"
											CornerRadius="12"
											Width="20" Height="20">
										<TextBlock Text="−" 
												   Style="{StaticResource BodyTextStyle}"
												   FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource TextMutedBrush}"/>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="Hypernetworks"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   Text="Optional"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource TextMutedBrush}"/>
								</Grid>

								Advanced Settings (Optional)
								<Grid Margin="0,0,0,0">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="24"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>
									
									<Border Grid.Column="0" 
											Background="{DynamicResource BorderBrush}"
											CornerRadius="12"
											Width="20" Height="20">
										<TextBlock Text="−" 
												   Style="{StaticResource BodyTextStyle}"
												   FontSize="12"
												   HorizontalAlignment="Center"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource TextMutedBrush}"/>
									</Border>
									
									<TextBlock Grid.Column="1" 
											   Text="Advanced Settings"
											   Style="{StaticResource BodyTextStyle}"
											   VerticalAlignment="Center"
											   Margin="12,0,0,0"/>
											   
									<TextBlock Grid.Column="2"
											   Text="Optional"
											   Style="{StaticResource CaptionTextStyle}"
											   FontSize="10"
											   VerticalAlignment="Center"
											   Foreground="{DynamicResource TextMutedBrush}"/>
								</Grid>
							</StackPanel>
						</Border>

						Navigation Button
						<Button Content="Configure Models" 
								x:Name="ConfigureModelsButton"
								Click="ConfigureModelsButton_Click"
								Style="{StaticResource PrimaryButtonStyle}"
								HorizontalAlignment="Center"
								Padding="24,12"
								FontSize="14"
								Margin="0,24,0,0"/>
					</StackPanel>
				</ScrollViewer>
			</Grid>-->

			<!-- Messages section now handled by ViewMode-aware Chat Messages Area above -->

		<!-- Input -->
		<Border Grid.Row="1"
				Background="{DynamicResource TertiaryDarkBrush}"
				CornerRadius="8"
				Padding="8"
				Margin="0,8,0,0"
				Visibility="{Binding HasBaseModel, Converter={StaticResource BooleanToVisibilityConverter}}">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<TextBox x:Name="InputBox"
						 Grid.Column="0"
						 Text="{Binding Input, UpdateSourceTrigger=PropertyChanged}"
						 Style="{StaticResource DarkTextBoxMultilineStyle}"
						 MinHeight="36"
						 MaxHeight="120"
						 Background="Transparent"
						 BorderThickness="0"
						 VerticalAlignment="Center"
						 FontFamily="Consolas"
						 IsEnabled="{Binding HasBaseModel}">
					<TextBox.InputBindings>
						<KeyBinding Command="{Binding SendCommand}"
									Key="Return" />
					</TextBox.InputBindings>
				</TextBox>

				<Button Grid.Column="1"
						Content="Send"
						Command="{Binding SendCommand}"
						Margin="5"
						Padding="10,5">
					<Button.Style>
						<Style TargetType="Button"
							   BasedOn="{StaticResource PrimaryButtonStyle}">
							<Style.Triggers>
								<Trigger Property="IsEnabled"
										 Value="False">
									<Setter Property="Background"
											Value="{DynamicResource BorderBrush}"/>
									<Setter Property="Foreground"
											Value="{DynamicResource TextDisabledBrush}"/>
								</Trigger>
							</Style.Triggers>
						</Style>
					</Button.Style>
				</Button>

			</Grid>
		</Border>
	</Grid>

	<!-- Dynamic Parameters Panel -->
	<Border Grid.Column="1"
			Background="{DynamicResource SecondaryDarkBrush}"
			CornerRadius="8"
			Margin="8,0,0,0"
			Padding="12"
			Visibility="{Binding HasBaseModel, Converter={StaticResource BooleanToVisibilityConverter}}">
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<!-- Header -->
			<StackPanel Grid.Row="0" Margin="0,0,0,12">
				<TextBlock Text="Model Parameters"
						   Style="{StaticResource BodyTextStyle}"
						   FontSize="14"
						   FontWeight="SemiBold"
						   Margin="0,0,0,6"/>
				<TextBlock Text="{Binding ParameterViewModel.ModelSummary}"
						   Style="{StaticResource CaptionTextStyle}"
						   TextWrapping="Wrap"
						   Opacity="0.8"/>
						   
				<!-- LoRA Status Indicator with Clear Messaging -->
				<Border CornerRadius="6"
						Padding="10,6"
						Margin="0,8,0,0">
					<Border.Style>
						<Style TargetType="Border">
							<Setter Property="Background" Value="{DynamicResource AccentRedBrush}"/>
							<Setter Property="Visibility" Value="{Binding ParameterViewModel.HasActiveLoRAs, Converter={StaticResource BooleanToVisibilityConverter}}"/>
							<Style.Triggers>
								<DataTrigger Binding="{Binding ParameterViewModel.HasActiveLoRAs}" Value="False">
									<Setter Property="Background" Value="{DynamicResource BorderBrush}"/>
									<Setter Property="Visibility" Value="{Binding ParameterViewModel.AppliedLoRAs.Count, Converter={StaticResource ZeroToVisibilityConverter}, ConverterParameter=Inverse}"/>
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</Border.Style>
					
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						
						<!-- Status Icon -->
						<TextBlock Grid.Column="0"
								   FontSize="16"
								   VerticalAlignment="Center"
								   Margin="0,0,8,0">
							<TextBlock.Style>
								<Style TargetType="TextBlock" BasedOn="{StaticResource BodyTextStyle}">
									<Setter Property="Text" Value="⚡"/>
									<Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding ParameterViewModel.HasActiveLoRAs}" Value="False">
											<Setter Property="Text" Value="💤"/>
											<Setter Property="Foreground" Value="{DynamicResource TextMutedBrush}"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBlock.Style>
						</TextBlock>
								   
						<StackPanel Grid.Column="1">
							<!-- Main Status Header -->
							<TextBlock FontSize="13"
									   FontWeight="SemiBold"
									   Foreground="{DynamicResource TextPrimaryBrush}">
								<TextBlock.Style>
									<Style TargetType="TextBlock" BasedOn="{StaticResource BodyTextStyle}">
										<Setter Property="Text" Value="Adapters Active - Model Modified"/>
										<Style.Triggers>
											<DataTrigger Binding="{Binding ParameterViewModel.HasActiveLoRAs}" Value="False">
												<Setter Property="Text" Value="Adapters Inactive - Base Model"/>
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</TextBlock.Style>
							</TextBlock>
							
							<!-- Detailed Status -->
							<TextBlock Text="{Binding ParameterViewModel.LoRAStatusSummary}"
									   Style="{StaticResource CaptionTextStyle}"
									   FontSize="12"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   TextWrapping="Wrap"
									   Opacity="0.9"
									   Margin="0,2,0,0"/>
						</StackPanel>
					</Grid>
				</Border>
			</StackPanel>

			<!-- Dynamic Parameter Controls -->
			<ScrollViewer Grid.Row="1"
						  VerticalScrollBarVisibility="Auto"
						  HorizontalScrollBarVisibility="Disabled">
				<ContentControl Content="{Binding ParameterViewModel.DynamicUI}"
								HorizontalContentAlignment="Stretch"/>
			</ScrollViewer>
		</Grid>
	</Border>

</Grid>
</UserControl>