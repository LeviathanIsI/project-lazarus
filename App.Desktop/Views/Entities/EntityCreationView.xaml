<UserControl x:Class="Lazarus.Desktop.Views.Entities.EntityCreationView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d"
			 Background="{DynamicResource PrimaryDarkBrush}">
	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="320" MinWidth="220"/>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="300" MinWidth="200"/>
		</Grid.ColumnDefinitions>

		<!-- Left Panel: Entity Configuration -->
		<Border Grid.Column="0"
				Background="{DynamicResource SecondaryDarkBrush}"
				CornerRadius="8,0,0,8"
				Margin="8,8,4,8">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel Margin="12">
					<TextBlock Text="Entity Creation"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   FontSize="18"
							   FontWeight="Bold"
							   Margin="0,0,0,16"/>

					<!-- Entity Name -->
					<TextBlock Text="Entity Name:"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   Margin="0,0,0,4"/>
					<TextBox Text="{Binding EntityName}"
							 Background="{DynamicResource TertiaryDarkBrush}"
							 Foreground="{DynamicResource TextPrimaryBrush}"
							 BorderBrush="{DynamicResource BorderBrush}"
							 Margin="0,0,0,12"/>

					<!-- Entity Type -->
					<TextBlock Text="Entity Type:"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   Margin="0,0,0,4"/>
					<ComboBox SelectedValue="{Binding EntityType}"
							  Style="{StaticResource DarkComboBoxStyle}"
							  Margin="0,0,0,12">
						<ComboBoxItem Content="Virtual Assistant" IsSelected="True"/>
						<ComboBoxItem Content="Conversation Partner"/>
						<ComboBoxItem Content="Expert Advisor"/>
						<ComboBoxItem Content="Character Roleplay"/>
						<ComboBoxItem Content="Educational Guide"/>
						<ComboBoxItem Content="Creative Collaborator"/>
					</ComboBox>

					<!-- Personality Profile -->
					<TextBlock Text="Personality Profile"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   FontSize="14"
							   FontWeight="Bold"
							   Margin="0,8,0,8"/>

					<TextBox x:Name="PersonalityDescription"
							 Text="{Binding PersonalityDescription}"
							 Height="80"
							 TextWrapping="Wrap"
							 AcceptsReturn="True"
							 Background="{DynamicResource TertiaryDarkBrush}"
							 Foreground="{DynamicResource TextPrimaryBrush}"
							 BorderBrush="{DynamicResource BorderBrush}"
							 Margin="0,0,0,12"/>

					<!-- 3D Model Selection -->
					<TextBlock Text="3D Avatar:"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   Margin="0,0,0,4"/>
					<ComboBox SelectedValue="{Binding Selected3DModel}"
							  Style="{StaticResource DarkComboBoxStyle}"
							  Margin="0,0,0,8">
						<ComboBoxItem Content="Female Professional"/>
						<ComboBoxItem Content="Male Casual"/>
						<ComboBoxItem Content="Android Avatar"/>
						<ComboBoxItem Content="Fantasy Character"/>
						<ComboBoxItem Content="Custom Model" IsSelected="True"/>
					</ComboBox>

					<Button Content="Browse 3D Model..."
							Command="{Binding Browse3DModelCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Height="36"
							MinWidth="140"
							Padding="12,4"
							Margin="0,0,0,12"/>

					<!-- Voice Selection -->
					<TextBlock Text="Voice Model:"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   Margin="0,0,0,4"/>
					<ComboBox SelectedValue="{Binding SelectedVoiceModel}"
							  Style="{StaticResource DarkComboBoxStyle}"
							  Margin="0,0,0,12">
						<ComboBoxItem Content="Sarah (Professional)" IsSelected="True"/>
						<ComboBoxItem Content="David (Friendly)"/>
						<ComboBoxItem Content="Emma (British)"/>
						<ComboBoxItem Content="Custom Voice Clone"/>
					</ComboBox>

					<!-- Behavioral Parameters -->
					<TextBlock Text="Behavioral Parameters"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   FontSize="14"
							   FontWeight="Bold"
							   Margin="0,8,0,8"/>

					<!-- Response Style -->
					<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
						<TextBlock Text="Formality:"
								   Foreground="{DynamicResource TextPrimaryBrush}"
								   Width="70"/>
						<Slider Value="{Binding FormalityLevel}"
								Minimum="0"
								Maximum="10"
								Width="130"
								VerticalAlignment="Center"/>
						<TextBlock Text="{Binding FormalityLevel, StringFormat=F0}"
								   Foreground="{DynamicResource TextPrimaryBrush}"
								   Width="30"
								   Margin="8,0,0,0"/>
					</StackPanel>

					<!-- Empathy Level -->
					<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
						<TextBlock Text="Empathy:"
								   Foreground="{DynamicResource TextPrimaryBrush}"
								   Width="70"/>
						<Slider Value="{Binding EmpathyLevel}"
								Minimum="0"
								Maximum="10"
								Width="130"
								VerticalAlignment="Center"/>
						<TextBlock Text="{Binding EmpathyLevel, StringFormat=F0}"
								   Foreground="{DynamicResource TextPrimaryBrush}"
								   Width="30"
								   Margin="8,0,0,0"/>
					</StackPanel>

					<!-- Creativity -->
					<StackPanel Orientation="Horizontal" Margin="0,0,0,8">
						<TextBlock Text="Creativity:"
								   Foreground="{DynamicResource TextPrimaryBrush}"
								   Width="70"/>
						<Slider Value="{Binding CreativityLevel}"
								Minimum="0"
								Maximum="10"
								Width="130"
								VerticalAlignment="Center"/>
						<TextBlock Text="{Binding CreativityLevel, StringFormat=F0}"
								   Foreground="{DynamicResource TextPrimaryBrush}"
								   Width="30"
								   Margin="8,0,0,0"/>
					</StackPanel>

					<!-- Create Entity Button -->
					<Button Content="Create Entity"
							Command="{Binding CreateEntityCommand}"
							Style="{StaticResource PrimaryButtonStyle}"
							Height="40"
							Margin="0,16,0,0"/>
				</StackPanel>
			</ScrollViewer>
		</Border>

		<!-- Left Splitter -->
		<GridSplitter Grid.Column="0"
					  Width="4"
					  Background="{DynamicResource BorderBrush}"
					  HorizontalAlignment="Right"
					  VerticalAlignment="Stretch"/>

		<!-- Center: 3D Preview -->
		<Border Grid.Column="1"
				Background="{DynamicResource TertiaryDarkBrush}"
				Margin="0,8">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<TextBlock Grid.Row="0"
						   Text="Entity Preview"
						   Foreground="{DynamicResource TextPrimaryBrush}"
						   FontSize="16"
						   FontWeight="Bold"
						   HorizontalAlignment="Center"
						   Margin="0,12,0,12"/>

				<!-- 3D Viewport -->
				<Border Grid.Row="1"
						Background="{DynamicResource PrimaryDarkBrush}"
						Margin="20"
						CornerRadius="8">
					<Grid>
						<!-- 3D Avatar Preview Placeholder -->
						<Viewport3D x:Name="EntityViewport3D">
							<!-- Camera -->
							<Viewport3D.Camera>
								<PerspectiveCamera Position="0,2,5" 
												   LookDirection="0,-2,-5" 
												   UpDirection="0,1,0" 
												   FieldOfView="45"/>
							</Viewport3D.Camera>
							
							<!-- Lighting -->
							<ModelVisual3D>
								<ModelVisual3D.Content>
									<DirectionalLight Color="White" Direction="1,-1,-1"/>
								</ModelVisual3D.Content>
							</ModelVisual3D>
							
							<!-- Placeholder 3D content -->
							<ModelVisual3D>
								<ModelVisual3D.Content>
									<GeometryModel3D>
										<GeometryModel3D.Geometry>
											<MeshGeometry3D Positions="0,0,0 1,0,0 0,1,0" TriangleIndices="0 1 2"/>
										</GeometryModel3D.Geometry>
										<GeometryModel3D.Material>
											<DiffuseMaterial Brush="#4f46e5"/>
										</GeometryModel3D.Material>
									</GeometryModel3D>
								</ModelVisual3D.Content>
							</ModelVisual3D>
						</Viewport3D>
						
						<!-- Overlay text when no model -->
						<TextBlock Text="ðŸ¤– 3D Avatar Preview"
								   Foreground="{DynamicResource TextSecondaryBrush}"
								   FontSize="20"
								   HorizontalAlignment="Center"
								   VerticalAlignment="Center"
								   Visibility="{Binding Has3DModel, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
					</Grid>
				</Border>

				<!-- 3D Controls -->
				<StackPanel Grid.Row="2"
							Orientation="Horizontal"
							HorizontalAlignment="Center"
							Margin="0,0,0,12">
					<Button Content="ðŸ”„ Rotate"
							Command="{Binding RotateModelCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							MinWidth="80"
							Height="36"
							Padding="8,4"
							Margin="4"
							ToolTip="Rotate the 3D avatar model"/>
					<Button Content="ðŸŽ­ Animate"
							Command="{Binding AnimateModelCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							MinWidth="80"
							Height="36"
							Padding="8,4"
							Margin="4"
							ToolTip="Preview avatar animations"/>
					<Button Content="ðŸŽ¤ Test Voice"
							Command="{Binding TestVoiceCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							MinWidth="80"
							Height="36"
							Padding="8,4"
							Margin="4"
							ToolTip="Test the selected voice model"/>
					<Button Content="ðŸ’¾ Export"
							Command="{Binding ExportEntityCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							MinWidth="80"
							Height="36"
							Padding="8,4"
							Margin="4"
							ToolTip="Export entity configuration"/>
				</StackPanel>

				<!-- Creation Progress -->
				<StackPanel HorizontalAlignment="Center"
							VerticalAlignment="Bottom"
							Margin="0,0,0,60"
							Visibility="{Binding IsCreating, Converter={StaticResource BooleanToVisibilityConverter}}">
					<ProgressBar IsIndeterminate="True"
								 Height="4"
								 Width="300"
								 Background="{DynamicResource SecondaryDarkBrush}"
								 Foreground="{DynamicResource AccentRedBrush}"/>
					<TextBlock Text="{Binding CreationStatus}"
							   Foreground="{DynamicResource TextPrimaryBrush}"
							   HorizontalAlignment="Center"
							   Margin="0,8,0,0"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Right Splitter -->
		<GridSplitter Grid.Column="1"
					  Width="4"
					  Background="{DynamicResource BorderBrush}"
					  HorizontalAlignment="Right"
					  VerticalAlignment="Stretch"/>

		<!-- Right Panel: Entity Templates -->
		<Border Grid.Column="2"
				Background="{DynamicResource SecondaryDarkBrush}"
				CornerRadius="0,8,8,0"
				Margin="4,8,8,8">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<TextBlock Grid.Row="0"
						   Text="Entity Templates"
						   Foreground="{DynamicResource TextPrimaryBrush}"
						   FontSize="14"
						   FontWeight="Bold"
						   Margin="12,12,12,8"/>

				<ListBox Grid.Row="1"
						 ItemsSource="{Binding EntityTemplates}"
						 Background="Transparent"
						 BorderThickness="0"
						 Margin="12,0">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<Border Background="{DynamicResource TertiaryDarkBrush}"
									CornerRadius="4"
									Margin="0,2"
									Padding="8">
								<StackPanel>
									<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
										<TextBlock Text="{Binding Icon}"
												   FontSize="20"
												   VerticalAlignment="Center"
												   Margin="0,0,8,0"/>
										<StackPanel>
											<TextBlock Text="{Binding Name}"
													   Foreground="{DynamicResource TextPrimaryBrush}"
													   FontSize="12"
													   FontWeight="Bold"/>
											<TextBlock Text="{Binding Type}"
													   Foreground="{DynamicResource TextSecondaryBrush}"
													   FontSize="10"/>
										</StackPanel>
									</StackPanel>
									
									<TextBlock Text="{Binding Description}"
											   Foreground="{DynamicResource TextSecondaryBrush}"
											   TextWrapping="Wrap"
											   FontSize="10"
											   Margin="0,0,0,4"/>
									
									<StackPanel Orientation="Horizontal">
										<Button Content="ðŸ“¥ Load"
												Command="{Binding DataContext.ApplyTemplateCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
												CommandParameter="{Binding}"
												Style="{StaticResource SecondaryButtonStyle}"
												Height="26"
												MinWidth="60"
												Padding="8,2"
												FontSize="9"
												ToolTip="Load this template into the form"/>
										<Button Content="ðŸ‘ï¸ View"
												Command="{Binding DataContext.PreviewTemplateCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
												CommandParameter="{Binding}"
												Style="{StaticResource SecondaryButtonStyle}"
												Height="26"
												MinWidth="60"
												Padding="8,2"
												FontSize="9"
												Margin="4,0,0,0"
												ToolTip="Preview template details"
												IsEnabled="False"
												Opacity="0.5"/>
									</StackPanel>
								</StackPanel>
							</Border>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>

				<!-- Quick Actions -->
				<StackPanel Grid.Row="2"
							Orientation="Horizontal"
							HorizontalAlignment="Center"
							Margin="12">
					<Button Content="ðŸ’¾ Save Current"
							Command="{Binding SaveTemplateCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Height="28"
							MinWidth="100"
							Padding="8,4"
							FontSize="10"
							ToolTip="Save current configuration as template"
							IsEnabled="False"
							Opacity="0.5"/>
					<Button Content="ðŸ“ Import File"
							Command="{Binding ImportTemplateCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Height="28"
							MinWidth="80"
							Padding="8,4"
							FontSize="10"
							Margin="8,0,0,0"
							ToolTip="Import template from file"
							IsEnabled="False"
							Opacity="0.5"/>
				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</UserControl>