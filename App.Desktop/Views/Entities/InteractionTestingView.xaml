<UserControl x:Class="Lazarus.Desktop.Views.Entities.InteractionTestingView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d"
			 Background="{DynamicResource PrimaryDarkBrush}">
	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="280" MinWidth="200"/>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="320" MinWidth="220"/>
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<!-- Left Panel: Test Scenarios -->
		<Border Grid.Column="0" Grid.Row="0"
				Background="{DynamicResource SecondaryDarkBrush}"
				CornerRadius="8,0,0,0"
				Margin="8,8,4,4">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<TextBlock Grid.Row="0"
						   Text="Test Scenarios"
						   Foreground="{DynamicResource TextPrimaryBrush}"
						   FontSize="18"
						   FontWeight="Bold"
						   HorizontalAlignment="Center"
						   Margin="12,12,12,12"/>

				<ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
					<StackPanel Margin="12,0">
						<ListBox ItemsSource="{Binding TestScenarios}"
								 SelectedItem="{Binding SelectedScenario}"
								 Background="Transparent"
								 BorderThickness="0">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<Border Background="{DynamicResource TertiaryDarkBrush}"
											CornerRadius="4"
											Margin="0,4"
											Padding="12"
											Cursor="Hand">
										<StackPanel>
											<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
												<TextBlock Text="{Binding Icon}"
														   FontSize="16"
														   VerticalAlignment="Center"
														   Margin="0,0,8,0"/>
												<TextBlock Text="{Binding Name}"
														   Foreground="{DynamicResource TextPrimaryBrush}"
														   FontSize="14"
														   FontWeight="Bold"
														   VerticalAlignment="Center"/>
											</StackPanel>
											
											<TextBlock Text="{Binding Description}"
													   Foreground="{DynamicResource TextSecondaryBrush}"
													   TextWrapping="Wrap"
													   FontSize="11"
													   Margin="0,0,0,4"/>
													   
											<StackPanel Orientation="Horizontal">
												<TextBlock Text="{Binding Difficulty}"
														   Foreground="{DynamicResource AccentRedBrush}"
														   FontSize="10"
														   FontWeight="Bold"/>
												<TextBlock Text=" â€¢ "
														   Foreground="{DynamicResource TextMutedBrush}"
														   FontSize="10"/>
												<TextBlock Text="{Binding EstimatedTime}"
														   Foreground="{DynamicResource TextMutedBrush}"
														   FontSize="10"/>
											</StackPanel>
										</StackPanel>
									</Border>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</StackPanel>
				</ScrollViewer>

				<Button Grid.Row="2"
						Content="ðŸ“ Create Custom Scenario"
						Command="{Binding CreateCustomScenarioCommand}"
						Style="{StaticResource SecondaryButtonStyle}"
						Height="32"
						MinWidth="180"
						Padding="12,4"
						Margin="12"
						ToolTip="Create a custom test scenario"/>
			</Grid>
		</Border>

		<!-- Center Panel: Live Chat Interface -->
		<Border Grid.Column="1" Grid.Row="0"
				Background="{DynamicResource TertiaryDarkBrush}"
				Margin="0,8,0,4">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Chat Header -->
				<Border Grid.Row="0"
						Background="{DynamicResource SecondaryDarkBrush}"
						Padding="16,8">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="ðŸ¤–"
								   FontSize="20"
								   VerticalAlignment="Center"
								   Margin="0,0,8,0"/>
						<StackPanel>
							<TextBlock Text="{Binding ActiveEntityName}"
									   Foreground="{DynamicResource TextPrimaryBrush}"
									   FontSize="14"
									   FontWeight="Bold"/>
							<TextBlock Text="{Binding ActiveScenarioName}"
									   Foreground="{DynamicResource TextSecondaryBrush}"
									   FontSize="11"/>
						</StackPanel>
						<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,0">
							<Border Background="{DynamicResource AccentRedBrush}"
									CornerRadius="4"
									Padding="8,2"
									Margin="8,0">
								<TextBlock Text="{Binding TestStatus}"
										   Foreground="White"
										   FontSize="10"
										   FontWeight="Bold"/>
							</Border>
						</StackPanel>
					</StackPanel>
				</Border>

				<!-- Chat Messages -->
				<ScrollViewer Grid.Row="1"
							  VerticalScrollBarVisibility="Auto"
							  Background="{DynamicResource PrimaryDarkBrush}"
							  Margin="8">
					<ItemsControl ItemsSource="{Binding ChatMessages}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Margin="8"
										CornerRadius="8"
										MaxWidth="400"
										HorizontalAlignment="{Binding IsUser, Converter={StaticResource BooleanToAlignmentConverter}}">
									<Border Background="{Binding IsUser, Converter={StaticResource MessageBackgroundConverter}}"
											CornerRadius="8"
											Padding="12,8">
										<StackPanel>
											<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
												<TextBlock Text="{Binding SenderIcon}"
														   FontSize="12"
														   VerticalAlignment="Center"
														   Margin="0,0,6,0"/>
												<TextBlock Text="{Binding Sender}"
														   Foreground="{DynamicResource TextSecondaryBrush}"
														   FontSize="10"
														   FontWeight="Bold"
														   VerticalAlignment="Center"/>
												<TextBlock Text="{Binding Timestamp, StringFormat=HH:mm:ss}"
														   Foreground="{DynamicResource TextMutedBrush}"
														   FontSize="9"
														   VerticalAlignment="Center"
														   Margin="8,0,0,0"/>
											</StackPanel>
											<TextBlock Text="{Binding Content}"
													   Foreground="{DynamicResource TextPrimaryBrush}"
													   TextWrapping="Wrap"
													   FontSize="12"/>
										</StackPanel>
									</Border>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>

				<!-- Message Input -->
				<Border Grid.Row="2"
						Background="{DynamicResource SecondaryDarkBrush}"
						Padding="12">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
						
						<TextBox Grid.Column="0"
								 Text="{Binding MessageText, UpdateSourceTrigger=PropertyChanged}"
								 Background="{DynamicResource TertiaryDarkBrush}"
								 Foreground="{DynamicResource TextPrimaryBrush}"
								 BorderBrush="{DynamicResource BorderBrush}"
								 Height="36"
								 VerticalContentAlignment="Center"
								 Padding="12,8"
								 Margin="0,0,8,0"
								 x:Name="MessageInput"
								 KeyDown="MessageInput_KeyDown"
								 ToolTip="Type your message to the entity"/>
						
						<Button Grid.Column="1"
								Content="âž¤"
								Command="{Binding SendMessageCommand}"
								Style="{StaticResource PrimaryButtonStyle}"
								Width="36"
								Height="36"
								FontSize="16"
								ToolTip="Send message"/>
					</Grid>
				</Border>
			</Grid>
		</Border>

		<!-- Right Panel: Behavioral Metrics -->
		<Border Grid.Column="2" Grid.Row="0"
				Background="{DynamicResource SecondaryDarkBrush}"
				CornerRadius="0,8,0,0"
				Margin="4,8,8,4">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<TextBlock Grid.Row="0"
						   Text="Behavioral Metrics"
						   Foreground="{DynamicResource TextPrimaryBrush}"
						   FontSize="14"
						   FontWeight="Bold"
						   Margin="12,12,12,8"/>

				<ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
					<StackPanel Margin="12,0">
						<!-- Response Consistency -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="4"
								Padding="12"
								Margin="0,0,0,8">
							<StackPanel>
								<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
									<TextBlock Text="ðŸŽ¯ Response Consistency"
											   Foreground="{DynamicResource TextPrimaryBrush}"
											   FontSize="12"
											   FontWeight="Bold"
											   VerticalAlignment="Center"/>
									<TextBlock Text="{Binding ResponseConsistency, StringFormat=P0}"
											   Foreground="{DynamicResource AccentRedBrush}"
											   FontSize="14"
											   FontWeight="Bold"
											   HorizontalAlignment="Right"
											   Margin="8,0,0,0"/>
								</StackPanel>
								<ProgressBar Value="{Binding ResponseConsistency}"
											 Maximum="1"
											 Height="6"
											 Background="{DynamicResource PrimaryDarkBrush}"
											 Foreground="{DynamicResource AccentRedBrush}"/>
							</StackPanel>
						</Border>

						<!-- Emotional Appropriateness -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="4"
								Padding="12"
								Margin="0,0,0,8">
							<StackPanel>
								<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
									<TextBlock Text="ðŸ’ Emotional Appropriateness"
											   Foreground="{DynamicResource TextPrimaryBrush}"
											   FontSize="12"
											   FontWeight="Bold"
											   VerticalAlignment="Center"/>
									<TextBlock Text="{Binding EmotionalAppropriateness, StringFormat=P0}"
											   Foreground="{DynamicResource AccentRedBrush}"
											   FontSize="14"
											   FontWeight="Bold"
											   HorizontalAlignment="Right"
											   Margin="8,0,0,0"/>
								</StackPanel>
								<ProgressBar Value="{Binding EmotionalAppropriateness}"
											 Maximum="1"
											 Height="6"
											 Background="{DynamicResource PrimaryDarkBrush}"
											 Foreground="{DynamicResource AccentRedBrush}"/>
							</StackPanel>
						</Border>

						<!-- Topic Adherence -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="4"
								Padding="12"
								Margin="0,0,0,8">
							<StackPanel>
								<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
									<TextBlock Text="ðŸŽ¯ Topic Adherence"
											   Foreground="{DynamicResource TextPrimaryBrush}"
											   FontSize="12"
											   FontWeight="Bold"
											   VerticalAlignment="Center"/>
									<TextBlock Text="{Binding TopicAdherence, StringFormat=P0}"
											   Foreground="{DynamicResource AccentRedBrush}"
											   FontSize="14"
											   FontWeight="Bold"
											   HorizontalAlignment="Right"
											   Margin="8,0,0,0"/>
								</StackPanel>
								<ProgressBar Value="{Binding TopicAdherence}"
											 Maximum="1"
											 Height="6"
											 Background="{DynamicResource PrimaryDarkBrush}"
											 Foreground="{DynamicResource AccentRedBrush}"/>
							</StackPanel>
						</Border>

						<!-- Personality Alignment -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="4"
								Padding="12"
								Margin="0,0,0,8">
							<StackPanel>
								<StackPanel Orientation="Horizontal" Margin="0,0,0,4">
									<TextBlock Text="ðŸŽ­ Personality Alignment"
											   Foreground="{DynamicResource TextPrimaryBrush}"
											   FontSize="12"
											   FontWeight="Bold"
											   VerticalAlignment="Center"/>
									<TextBlock Text="{Binding PersonalityAlignment, StringFormat=P0}"
											   Foreground="{DynamicResource AccentRedBrush}"
											   FontSize="14"
											   FontWeight="Bold"
											   HorizontalAlignment="Right"
											   Margin="8,0,0,0"/>
								</StackPanel>
								<ProgressBar Value="{Binding PersonalityAlignment}"
											 Maximum="1"
											 Height="6"
											 Background="{DynamicResource PrimaryDarkBrush}"
											 Foreground="{DynamicResource AccentRedBrush}"/>
							</StackPanel>
						</Border>

						<!-- Response Time Tracking -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="4"
								Padding="12"
								Margin="0,0,0,8">
							<StackPanel>
								<TextBlock Text="â±ï¸ Response Metrics"
										   Foreground="{DynamicResource TextPrimaryBrush}"
										   FontSize="12"
										   FontWeight="Bold"
										   Margin="0,0,0,8"/>
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="*"/>
									</Grid.ColumnDefinitions>
									<StackPanel Grid.Column="0">
										<TextBlock Text="Avg Response:"
												   Foreground="{DynamicResource TextSecondaryBrush}"
												   FontSize="10"/>
										<TextBlock Text="{Binding AverageResponseTime}"
												   Foreground="{DynamicResource TextPrimaryBrush}"
												   FontSize="11"
												   FontWeight="Bold"/>
									</StackPanel>
									<StackPanel Grid.Column="1">
										<TextBlock Text="Last Response:"
												   Foreground="{DynamicResource TextSecondaryBrush}"
												   FontSize="10"/>
										<TextBlock Text="{Binding LastResponseTime}"
												   Foreground="{DynamicResource TextPrimaryBrush}"
												   FontSize="11"
												   FontWeight="Bold"/>
									</StackPanel>
								</Grid>
							</StackPanel>
						</Border>

						<!-- Behavioral Deviation Alerts -->
						<Border Background="{DynamicResource TertiaryDarkBrush}"
								CornerRadius="4"
								Padding="12"
								Margin="0,0,0,8">
							<StackPanel>
								<TextBlock Text="âš ï¸ Behavioral Alerts"
										   Foreground="{DynamicResource TextPrimaryBrush}"
										   FontSize="12"
										   FontWeight="Bold"
										   Margin="0,0,0,4"/>
								<ItemsControl ItemsSource="{Binding BehavioralAlerts}">
									<ItemsControl.ItemTemplate>
										<DataTemplate>
											<Border Background="{DynamicResource PrimaryDarkBrush}"
													CornerRadius="2"
													Padding="8,4"
													Margin="0,2">
												<StackPanel Orientation="Horizontal">
													<TextBlock Text="{Binding Icon}"
															   FontSize="10"
															   VerticalAlignment="Center"
															   Margin="0,0,4,0"/>
													<TextBlock Text="{Binding Message}"
															   Foreground="{DynamicResource TextPrimaryBrush}"
															   FontSize="10"
															   TextWrapping="Wrap"
															   VerticalAlignment="Center"/>
												</StackPanel>
											</Border>
										</DataTemplate>
									</ItemsControl.ItemTemplate>
								</ItemsControl>
							</StackPanel>
						</Border>
					</StackPanel>
				</ScrollViewer>

				<!-- Analysis Tools -->
				<StackPanel Grid.Row="2" Margin="12">
					<Button Content="ðŸ“Š View Conversation Flow"
							Command="{Binding ViewConversationFlowCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Height="28"
							MinWidth="200"
							Padding="8,4"
							Margin="0,0,0,4"
							ToolTip="Visualize conversation flow patterns"/>
					<Button Content="ðŸ” Analyze Session"
							Command="{Binding AnalyzeSessionCommand}"
							Style="{StaticResource SecondaryButtonStyle}"
							Height="28"
							MinWidth="200"
							Padding="8,4"
							ToolTip="Generate detailed session analysis"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Bottom Section: Session Controls -->
		<Border Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1"
				Background="{DynamicResource SecondaryDarkBrush}"
				CornerRadius="0,0,8,8"
				Margin="8,4,8,8">
			<StackPanel Orientation="Horizontal"
						HorizontalAlignment="Center"
						Margin="12">
				<Button Content="ðŸš€ Start Test Session"
						Command="{Binding StartTestCommand}"
						Style="{StaticResource PrimaryButtonStyle}"
						Height="36"
						MinWidth="140"
						Padding="12,4"
						Margin="4"
						ToolTip="Start new test session with selected scenario"
						Visibility="{Binding IsTestActive, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
				
				<Button Content="â¹ï¸ Stop Test Session"
						Command="{Binding StopTestCommand}"
						Style="{StaticResource SecondaryButtonStyle}"
						Height="36"
						MinWidth="140"
						Padding="12,4"
						Margin="4"
						ToolTip="Stop current test session"
						Visibility="{Binding IsTestActive, Converter={StaticResource BooleanToVisibilityConverter}}"/>
				
				<Button Content="ðŸ’¾ Save Conversation"
						Command="{Binding SaveConversationCommand}"
						Style="{StaticResource SecondaryButtonStyle}"
						Height="36"
						MinWidth="140"
						Padding="12,4"
						Margin="4"
						ToolTip="Save conversation history"/>
				
				<Button Content="ðŸ“¤ Export Results"
						Command="{Binding ExportResultsCommand}"
						Style="{StaticResource SecondaryButtonStyle}"
						Height="36"
						MinWidth="120"
						Padding="12,4"
						Margin="4"
						ToolTip="Export test results and metrics"/>
				
				<Button Content="ðŸ”„ Reset Entity State"
						Command="{Binding ResetEntityStateCommand}"
						Style="{StaticResource SecondaryButtonStyle}"
						Height="36"
						MinWidth="140"
						Padding="12,4"
						Margin="4"
						ToolTip="Reset entity to initial state"/>
			</StackPanel>
		</Border>
	</Grid>
</UserControl>